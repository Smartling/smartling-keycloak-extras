machine:
  environment:
    LANG: en_US.UTF-8
  java:
    version: oraclejdk7

dependencies:
  override:
    - mvn -Dhttps.protocols="TLSv1.2" -U dependency:go-offline

test:
  override:
    - ./gradlew test
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/test-results/test/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

deployment:
  snapshot:
    branch: maven
    commands:
      - mvn -Dhttps.protocols="TLSv1.2" install
  release:
    branch: master
    commands:
      - rm -f gradle.properties
      - ./gradlew -Prelease=true -PbintrayUser=${BINTRAY_USER} -PbintrayKey=${BINTRAY_API_KEY} clean bintrayUpload
